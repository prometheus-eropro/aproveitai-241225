<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>√Årea do Cliente | Cart√£o AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:system-ui,Arial,sans-serif;background:linear-gradient(135deg,#bdeeff,#81d4fa);color:#232630}
.brandline{display:grid;grid-template-columns:140px 1fr 140px;gap:12px;align-items:center;justify-items:center;margin:18px auto 0;max-width:600px}
.brandline img{height:100px;object-fit:contain}
.pill{background:#e9fff1;border:1px solid #b7efc2;color:#0a4c1a;border-radius:999px;padding:12px 20px;font-weight:900;font-size:1.6rem;text-align:center}
.wrap{max-width:600px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;box-shadow:0 6px 22px #0001;padding:20px;margin:18px auto}
input{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #ccc}
button{margin-top:16px;padding:12px 18px;font-weight:700;color:#fff;border:none;border-radius:10px;cursor:pointer;background:#0a7f2e;width:100%}
.btn2{margin-top:12px;background:#0a7f2e}
.voltar{display:inline-block;margin-top:14px;padding:10px 14px;background:#0a7f2e;color:#fff;border-radius:10px;text-decoration:none;font-weight:800}
#resultado{margin-top:14px;border-radius:12px;padding:14px;border:1px solid #e5eaee;background:#f7fbff}
#resultado.ativo{background:#e9fbe9;border:2px solid #1e8e3e}
#resultado.inativo{background:#fdeaea;border:2px solid #d93025}
.small{font-size:.9rem;color:#444;text-align:center;margin-top:6px}
</style>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0a7f2e">

</head>

<body>

<div class="brandline">
  <img src="logo-prometheus.png">
  <div class="pill">Cart√£o AproveitAI</div>
  <img src="logo-aproveitai.png">
</div>

<div class="wrap">
  <div class="card">
    <h2 style="text-align:center;margin:0 0 10px;color:#0a4c1a">Bem-vindo √† √Årea do Cliente</h2>

    <input id="cpf" placeholder="Digite seu CPF ou ID P√∫blico (APV-XXXX)">
<button onclick="consultar()">Consultar</button>

<div class="small">Ap√≥s a consulta, voc√™ poder√° acessar seu cart√£o digital, salvar no celular ou imprimir.</div>

<!-- üî∏ Legenda √∫nica e fixa -->
<div id="legenda" style="font-size:12px;text-align:center;margin-top:10px;color:#555;">
  <b>Legenda:</b> üü© Exclusivo para voc√™ &nbsp; üü® Do seu grupo &nbsp; ‚ö™ Para todos
</div>

<div id="resultado"></div>
<h3 style="text-align:center;margin-top:25px;color:#0a4c1a">Benef√≠cios dispon√≠veis</h3>
<div id="beneficiosCliente" class="card" style="display:none;background:#fefefe"></div>

<h3 style="text-align:center;margin-top:25px;color:#0a4c1a">Promo√ß√µes dispon√≠veis</h3>
<div id="promocoesCliente" class="card" style="display:none;background:#fefefe"></div>

    <button id="btnCartao" class="btn2" style="display:none" onclick="abrirCartao()">Ver / Salvar Cart√£o</button>
    <div style="text-align:center"><a class="voltar" <a href="index.html" class="btn-aproveitai">‚Üê Voltar ao site</a>

  </div>
</div>

<script>
/* ======================================================
   PAINEL DO CLIENTE ‚Äì CART√ÉO APROVEITAI
   Script √∫nico, limpo e est√°vel
   ====================================================== */

const sheetURL = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";

/* ===============================
   FUN√á√ÉO PRINCIPAL
   =============================== */
async function consultar() {
  const input = document.getElementById("cpf").value.trim();
  const box = document.getElementById("resultado");

  box.classList.remove("ativo", "inativo");

  box.innerHTML = "Consultando...";

  if (!input) {
    box.innerHTML = "‚ùå Informe seu CPF ou ID P√∫blico.";
    return;
  }

  const somenteNumeros = input.replace(/\D/g, "");
  const isCPF = somenteNumeros.length === 11;

  try {
    const url = isCPF
      ? `${sheetURL}?clienteCPF=${encodeURIComponent(somenteNumeros)}`
      : `${sheetURL}?clienteID=${encodeURIComponent(input)}`;

    const res = await fetch(url);
    const data = await res.json();

    if (!data || !data.nome) {
      box.classList.add("inativo");
box.innerHTML = "‚ùå Cliente n√£o encontrado.";
document.getElementById("btnCartao").style.display = "none";
return;
    }

    const dataAceite = data.dataAceite
      ? formatarData(data.dataAceite)
      : "-";

    box.classList.add(data.ativo === "SIM" ? "ativo" : "inativo");

    box.innerHTML = `
      <div class="status-box">
        <h3>${data.nome}</h3>
        <p><b>Status:</b> ${data.ativo === "SIM" ? "ATIVO" : "INATIVO"}</p>
        <p><b>CPF:</b> ${mascararCPF(data.cpf)}</p>
        <p><b>N¬∫ do Cart√£o:</b> ${data.cartao || "-"}</p>
        <p><b>Data de Aceite:</b> ${dataAceite}</p>
        <p><b>Grupo:</b> ${data.grupo || "geral"}</p>
        ${
          data.ativo === "SIM"
            ? `<p class="codigo">‚úî C√≥digo: ${data.codigoERO}</p>`
            : ""
        }
      </div>
    `;

    document.getElementById("btnCartao").style.display =
      data.ativo === "SIM" ? "block" : "none";
  } catch (e) {
    console.error(e);
    box.innerHTML = "‚ùå Erro ao consultar. Tente novamente.";
  }
}
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("beneficiosCliente").style.display = "none";
  document.getElementById("promocoesCliente").style.display = "none";
});

/* ===============================
   UTILIDADES
   =============================== */
function mascararCPF(cpf) {
  if (!cpf) return "-";
  return cpf.replace(/^(\d{3})\d{3}\d{3}(\d{2})$/, "$1*** ***$2");
}

function formatarData(valor) {
  const d = new Date(valor);
  if (isNaN(d)) return valor;
  return d.toLocaleDateString("pt-BR") + " " +
         d.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });
}
function abrirCartao() {
  window.location.href = "cartao.html";
}

</script>

</body>
</html>