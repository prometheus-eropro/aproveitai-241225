<!DOCTYPE html>
<html lang="pt-BR">
<head>

<meta charset="UTF-8">
<title>√Årea do Parceiro ‚Ä¢ Cart√£o AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:system-ui,Arial,sans-serif;background:linear-gradient(135deg,#bdeeff,#81d4fa);color:#232630}
.brandline{display:grid;grid-template-columns:140px 1fr 140px;gap:12px;align-items:center;justify-items:center;margin:18px auto 0;max-width:600px}
.brandline img{height:100px;object-fit:contain}
.pill{background:#e9fff1;border:1px solid #b7efc2;color:#0a4c1a;border-radius:999px;padding:12px 20px;font-weight:900;font-size:1.6rem;text-align:center}
.wrap{max-width:600px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;box-shadow:0 6px 22px #0001;padding:20px;margin:18px auto}
input{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #ccc}
button{margin-top:16px;padding:12px 18px;font-weight:800;color:#fff;border:none;border-radius:10px;cursor:pointer;width:100%}
.verde{background:#0a7f2e}
.vermelho{background:#d10000}
#resultado{margin-top:14px;border-radius:12px;padding:14px;border:1px solid #e5eaee;background:#f7fbff}
#resultado.ativo{background:#e9fbe9;border:2px solid #1e8e3e}
#resultado.inativo{background:#fdeaea;border:2px solid #d93025}
.voltar{display:inline-block;margin-top:14px;padding:10px 14px;background:#0a7f2e;color:#fff;border-radius:10px;text-decoration:none;font-weight:800}
.small{font-size:.9rem;color:#444;margin-top:6px}
.btn-relatorio {
  background-color: #0d6efd; /* azul */
  color: #fff;
  border: none;
  padding: 12px;
  width: 100%;
  font-size: 15px;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 10px;
}

.btn-relatorio:hover {
  background-color: #084298;
}

.btn-imprimir {
  background-color: #198754; /* verde */
  color: #fff;
  border: none;
  padding: 12px;
  width: 100%;
  font-size: 15px;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 10px;
}

.btn-imprimir:hover {
  background-color: #146c43;
}
.vermelho:hover {
  background:#bb2d3b;
  transition:background 0.2s ease;
}

</style>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0a7f2e">

</head>

<body>
<div class="brandline">
  <img src="logo-prometheus.png">
  <div class="pill">Cart√£o AproveitAI</div>
  <img src="logo-aproveitai.png">
</div>

<div class="wrap">

  <!-- LOGIN -->
  <div class="card" id="loginBox">

    <h2 style="margin:0;color:#0a4c1a;text-align:center">Acesso do Parceiro</h2>
    <div class="small"><b>Parceiro</b> use seu CNPJ e token cadastrado.</div>

    <label>CNPJ</label>
    <input id="cnpj" placeholder="Digite seu CNPJ">
    <label>Token</label>
    <input id="token" type="password" placeholder="Digite seu token">

    <button class="verde" onclick="entrarParceiro()">Entrar</button>
<div id="resultado"></div>

    <div id="erroLogin" style="color:#d10000;font-weight:800;margin-top:10px;text-align:center"></div>
    <div style="text-align:center"><a class="voltar" <a href="index.html" class="btn-aproveitai">‚Üê Voltar ao site</a>

  </div>

  <!-- PAINEL -->


  <div class="card" id="painelBox" style="display:none">
    <h2 style="margin:0;color:#0a4c1a;text-align:center">Bem-vindo, <span id="nomeParceiro"></span></h2>
    <label>CPF ou ID P√∫blico do Cliente</label>
    <input id="cpfCliente" placeholder="Digite o CPF (11 d√≠gitos) ou APV-XXXXX">

    <button class="verde" onclick="validarCliente()">Validar Cliente</button>
<div id="resultadoCliente"></div>

<div id="boxResultado" style="
  display:none;
  margin-top:25px;
  padding:18px;
  border-radius:12px;
  border:2px solid #198754;
  background:#f6fff8;
  font-size:15px;
  line-height:1.6;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
"></div>


<button class="btn-relatorio"
onclick="window.open(sheetURL + '?relatorio=1','_blank')">
üìä Ver relat√≥rio de consultas
</button>

<!-- BOT√ÉO SAIR / VOLTAR -->
<div style="margin-top:15px;text-align:center;">
  <button onclick="location.reload()" class="vermelho">
‚¨ÖÔ∏è Sair / Voltar
</button>
</div>

<script>
/* ======================================================
   PAINEL DO PARCEIRO ‚Äì CART√ÉO APROVEITAI
   Script √∫nico, limpo e est√°vel
   ====================================================== */

const sheetURL = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";

/* ===============================
   LOGIN DO PARCEIRO
   =============================== */
async function entrarParceiro() {
  const cnpj = document.getElementById("cnpj").value.trim();
  const token = document.getElementById("token").value.trim();
  const box = document.getElementById("resultado");

  box.innerHTML = "Validando...";

  if (!cnpj || !token) {
    box.innerHTML = "‚ùå Informe CNPJ e token.";
    return;
  }

  try {
    const url = `${sheetURL}?parceiroCNPJ=${encodeURIComponent(
      cnpj
    )}&token=${encodeURIComponent(token)}`;

    const res = await fetch(url);
    const data = await res.json();

    if (!data || data.erro) {
      box.innerHTML = "‚ùå Acesso negado.";
      return;
    }

    box.innerHTML = `
      <div class="status-box">
        <h3>${data.parceiro}</h3>
        <p><b>Status:</b> ATIVO</p>
      </div>
    `;

    document.getElementById("painelBox").style.display = "block";
document.getElementById("loginBox").style.display = "none";

  } catch (e) {
    console.error(e);
    box.innerHTML = "‚ùå Erro ao validar parceiro.";
  }
}

/* ===============================
   VALIDAR CLIENTE
   =============================== */
async function validarCliente() {
  const cpf = document.getElementById("cpfCliente").value.trim();
  const box = document.getElementById("resultadoCliente");

  box.innerHTML = "Consultando...";

  if (!cpf) {
    box.innerHTML = "‚ùå Informe o CPF.";
    return;
  }

  try {
    const url = `${sheetURL}?validarCPF=${encodeURIComponent(
      cpf.replace(/\D/g, "")
    )}`;

    const res = await fetch(url);
    const data = await res.json();

    if (!data || !data.nome) {
      box.innerHTML = "‚ùå Cliente n√£o encontrado.";
      return;
    }

    const dataAceite = data.dataAceite
      ? formatarData(data.dataAceite)
      : "-";

    box.innerHTML = `
      <div class="status-box ativo">
        <p><b>Nome:</b> ${data.nome}</p>
        <p><b>Status:</b> ATIVO</p>
        <p><b>Data de Aceite:</b> ${dataAceite}</p>
        <p class="codigo">‚úî C√≥digo: ${data.codigoERO}</p>
      </div>
    `;
  } catch (e) {
    console.error(e);
    box.innerHTML = "‚ùå Erro ao validar cliente.";
  }
}

/* ===============================
   UTILIDADE
   =============================== */
function formatarData(valor) {
  const d = new Date(valor);
  if (isNaN(d)) return valor;
  return d.toLocaleDateString("pt-BR") + " " +
         d.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });
}
</script>
</body>
</html>
